# ADR: Открытие депозитов онлайн (MVP)

### Название задачи:
MVP открытия депозитов онлайн (сайт и интернет-банк)

### Автор:
Команда цифровой трансформации

### Дата:
2025-12-07

### Функциональные требования
Верхнеуровневые Use Cases с пошаговым описанием.

| № | Действующие лица или системы  | Use Case                 | Описание                                                                                                                                                                   |
|:-:|:------------------------------|:-------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 | Пользователь сайта            | Подача заявки на депозит | Просмотр актуальных ставок, отправка заявки (ФИО, телефон) по HTTPS; создание обращения в системе кол-центра; менеджер звонит и предлагает условия.                        |
| 2 | Оператор кол-центра           | Обработка заявки с сайта | Получение заявки в системе кол-центра; предложение стандартных/специальных условий; фиксация статуса; инициирование СМС уведомления клиенту о ставке и визите в отделение. |
| 3 | Пользователь интернет-банка   | Заявка на депозит        | Просмотр доступных и персональных ставок; выбор счёта и суммы; подтверждение заявки СМС-кодом; передача заявки на обработку в АБС через промежуточный слой/очередь.        |
| 4 | Менеджер бэк-офиса (депозиты) | Подтверждение условий    | Рассмотрение заявки; расчёт/подтверждение ставки; создание депозита в АБС; инициирование СМС-уведомления о подтверждении ставки и об открытии депозита.                    |
| 5 | Система (бэк-офис)            | Управление ставками      | Ведение/согласование ставок в АБС (новый модуль) с аудитом; публикация справочника ставок для цифровых каналов.                                                            |
| 6 | Система (СМС)                 | СМС уведомления          | Отправка СМС через СМС-шлюз банка к телеком-оператору; уведомления о ставке и об открытии депозита.                                                                        |

### Нефункциональные требования
Архитектурно значимые требования.

| №  | Требование                                                                                                      |
|:--:|:----------------------------------------------------------------------------------------------------------------|
| 1  | Шифрование трафика (HTTPS/TLS) для сайта и интернет-банка; защита ПДн.                                          |
| 2  | Доступность 99,9% для каналов; работа 24/7; переключение между ЦОД.                                             |
| 3  | Избежать прямых вызовов АБС из интернет-банка; ввести промежуточный слой/очередь (антикоррупционный слой).      |
| 4  | Быстрый отклик UI (миллисекунды); ускорить справочники (<200 мс) с помощью кэшей.                               |
| 5  | Горизонтальное масштабирование интернет-банка; балансировка между серверами и ЦОД (sticky/redis для сессий).    |
| 6  | АБС только вертикальное масштабирование; минимизировать нагрузку, применять асинхронность.                      |
| 7  | Использовать существующие технологии: MS SQL, Oracle, .NET Framework/ASP.NET MVC, Java/Spring Boot.             |
| 8  | Документация: ADR, диаграммы C4, наблюдаемость (логи/метрики/трейсинг, корреляционные ID).                      |
| 9  | Очереди: совместимые с текущим стеком; планируемая миграция на Kafka при несовместимости версии интернет-банка. |
| 10 | Разделение прав доступа кредитов/депозитов; аудит операций.                                                     |

### Решение
Диаграммы находятся в файлах:
- Task3/C4_Context_Deposits_MVP.puml - диаграмма контекста (PlantUML).
- Task3/C4_Containers_Deposits_MVP.puml - диаграмма контейнеров (PlantUML).

Краткое описание компонентов и интеграций:
- Пользователи и акторы: Клиент сайта, Клиент интернет-банка, Оператор кол-центра, Менеджер бэк-офиса.
- Системы: 
  - **Сайт** показывает ставки, принимает заявки, передаёт их в систему кол-центра.
  - **Интернет-банк** показывает персональные ставки, принимает заявки, подтверждает по СМС.
  - **Промежуточный слой/сервис заявок** принимает заявки из интернет-банка, размещает в очереди, реализует антикоррупционный слой к АБС.
  - **Очередь сообщений** асинхронная обработка заявок (адаптер к Kafka в перспективе).
  - **АБС** модуль обработки заявок и новый модуль управления ставками; создание депозитов.
  - **Система кол-центра** обработка заявок с сайта, статусы, инициирование СМС.
  - **СМС-шлюз банка -> Телеком-оператор** отправка СМС уведомлений.

Потоки данных (упрощённо):
- Сайт -> Система кол-центра: заявка (HTTPS) -> оператор -> статус/звонок -> СМС через шлюз.
- Интернет-банк -> Сервис заявок -> Очередь -> АБС: обработка и подтверждение -> событие -> СМС через шлюз -> статус в интернет-банк.
- Управление ставками: бэк-офис в АБС (новый модуль) -> публикация справочника ставок (кэш/реплика) для цифровых каналов.

Логика выбора решений:
- Разгружаем АБС: асинхронные заявки, антикоррупционный слой, кэширование справочников/ставок.
- Минимизируем новые технологии: используем .NET/Java, MS SQL/Oracle; очереди с планом миграции на Kafka.
- СМС через существующий шлюз банка; избегаем доработок ядра подрядчика интернет-банка.
- Наблюдаемость: централизованные логи/метрики/трейсинг с корреляционными ID.

### Альтернативы
- Прямые API вызовы интернет-банка в АБС: проще, но перегружает АБС, снижает надёжность.
- Отдельный микросервис ставок: быстрее для цифровых каналов, но усложняет согласование и безопасность; для MVP, модуль в АБС.
- Запуск Kafka сразу: упирается в несовместимость интернет-банка; выбран адаптер/совместимая очередь и поэтапная миграция.

### Недостатки, ограничения, риски
- АБС масштабируется вертикально: потенциальное узкое место при росте заявок; компенсируем кэшами и асинхронностью.
- Зависимость от подрядчиков (интернет-банк, кол-центр): скорость доработок ограничена.
- Согласование ставок в АБС: потребует минимального модуля с аудитом; сроки реализации увеличиваются.
- Требования 99,9% к интернет-банку: потребуются работы по инфраструктуре (балансировка, резервный ЦОД, тестирование переключений).

