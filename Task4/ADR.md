# ADR: Передача актуальных ставок в кол-центр (MVP)

### Название задачи:
Передача ставок по депозитам в системы кол-центров (внутренний и партнёрский) для консультаций клиентов

### Автор:
Команда цифровой трансформации

### Дата:
2025-12-07

### Функциональные требования
Use Cases, относящиеся к предоставлению ставок:

| № | Действующие лица или системы            | Use Case                  | Описание                                                                                                                                 |
|:-:|:----------------------------------------|:--------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------|
| 1 | Оператор внутреннего кол-центра         | Просмотр текущих ставок   | В веб-интерфейсе системы кол-центра оператор видит актуальные ставки по депозитам, доступные для консультаций.                           |
| 2 | Система внутреннего кол-центра          | Получение ставок из банка | Система периодически (или по событию) получает актуальные ставки из банка безопасным способом; ставки доступны для UI операторов.        |
| 3 | Оператор партнёрского кол-центра        | Консультация по ставкам   | Оператор партнёрского кол-центра использует внешние файлы со ставками, полученные от банка, для консультаций клиентов.                   |
| 4 | Партнёрский кол-центр (внешняя система) | Приём файлов со ставками  | Партнёр принимает файлы (CSV/XLSX) со ставками от банка через согласованный файловый канал (без API/SFTP).                               |
| 5 | Бэк-офис депозитов                      | Ведение ставок            | Бэк-офис ведёт и согласует ставки в АБС (новый модуль) с аудитом; публикация актуального справочника ставок для каналов.                 |
| 6 | Интернет-банк/Сайт                      | Отображение ставок        | Используют опубликованный справочник ставок для показа клиентам. (Контекст для согласованности с MVP, детализация вне фокуса этого ADR.) |

### Нефункциональные требования

| № | Требование                                                                                                           |
|:-:|:---------------------------------------------------------------------------------------------------------------------|
| 1 | Достоверность и актуальность: операторы видят актуальные ставки с минимальной задержкой.                             |
| 2 | Безопасность: шифрование трафика и защита ПДн, ограничение доступа к ставкам по ролям.                               |
| 3 | Надёжность: доступность 99,9% для публикации/чтения ставок, работа 24/7.                                             |
| 4 | Производительность: публикация и доставка справочника ставок - секунды, чтение ставок в UI - миллисекунды (кэш).     |
| 5 | Совместимость: использовать технологии банка (MS SQL, Oracle, .NET, Java). Очереди совместимые, Kafka в перспективе. |
| 6 | Операционные ограничения: партнёрский кол-центр принимает только файлы, без API/SFTP.                                |
| 7 | Разделение прав: разграничен доступ между депозитами и кредитами, аудит изменений ставок.                            |
| 8 | Наблюдаемость: логи/метрики/трейсинг для публикации и доставки файлов/данных.                                        |

### Решение
Диаграммы находятся в файлах:
- [Контекстная диаграмма C4](./c4_context.png)
- [Диаграмма компонентов C4](./c4_components.png)
- [Roadmap drawio](./roadmap.drawio)

Ключевые элементы:
- Модуль ставок в АБС: ведение/согласование, аудит.
- Публикация справочника ставок: экспорт из АБС в реплику/кэш (для внутренних систем), генерация файлов (CSV/XLSX) для партнёра.
- Внутренний кол-центр: сервис получения ставок (pull по HTTPS или подписка на событие), показ в UI.
- Партнёрский кол-центр: файловый канал - выгрузка на внешнюю площадку/канал, вручную или полуавтоматически, без API/SFTP.
- Интернет-банк/Сайт: чтение из кэша/реплики ставок.
- Наблюдаемость: журнал публикаций, контроль успешной доставки.

Логика решений:
- Используем АБС как источник истины по ставкам (минимум новых систем).
- Кэш/реплика ставок с быстрым чтением (милисекунды) для внутренних систем.
- Периодическая генерация файлов (CSV/XLSX) и передача по согласованному каналу (email/secure file drop), без API (для партнёров).
- Избегаем прямых нагрузок на АБС: публикация асинхронно, очереди совместимые, Kafka.

### Альтернативы
- API для партнёрского кол-центра: невозможно (по ограничению только файлы).
- Прямое чтение ставок кол-центром из АБС: повышает нагрузку и нарушает разграничение доступа.
- Отдельный микросервис ставок: быстрее для каналов, но усложняет согласование. В MVP модуль АБС.

### Недостатки, ограничения, риски
- Риск устаревших ставок у партнёра до следующей выгрузки: требуется частая выгрузка и явные версии файлов.
- Файловая доставка может быть ручной/полуавтоматической: операционные риски, нужен контроль получения.
- Нагрузка на АБС при частых публикациях: компенсировать кэшем/репликой.
- Согласование и аудит ставок, дополнительные сроки.

### Список крупных задач по системам

- АБС:
  - T1: Реализовать модуль ведения ставок с аудитом.
  - T2: Реализовать экспорт справочника ставок (API/выгрузка в реплику/кэш).
  - T3: Реализовать генерацию файлов ставок (CSV/XLSX) с метаданными (версия, дата, подпись).

- Промежуточный слой (сервис публикации):
  - T4: Сервис публикации ставок из АБС в кэш/реплику (pull/schedule, анти-коррупционный слой).
  - T5: Сервис генерации и доставки файлов партнёру (почта/secure drop) с журналом отправок.

- Система внутреннего кол-центра:
  - T6: Сервис получения ставок (pull по HTTPS) и сохранение в локальном хранилище.
  - T7: UI для операторов: отображение ставок, поиск/фильтры.

- Интернет-банк:
  - T8: Чтение ставок из кэша/реплики; UI обновление.

- Сайт:
  - T9: Чтение ставок из кэша/реплики; UI обновление.

- Наблюдаемость/Безопасность:
  - T10: Логи/метрики/трейсинг публикации; ролевая модель доступа.


